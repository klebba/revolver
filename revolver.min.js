//     Revolver.js Beta 1
//     http://github.com/klebba/revolver
//     (c) 2011-2012 Casey Klebba
//     Revolver may be freely distributed under the MIT license.
(function(){var i=function(a,b){var c=window.hasOwnProperty("Modernizr")?window.Modernizr:!1;this.options=$.extend(!0,{},{speed:1250,easing:"swing",mode:"fluid",touch:c&&c.touch,transforms:c&&c.csstransforms,transform3d:c&&c.csstransforms3d,transitions:c&&c.csstransitions,wraparound:!1,infinite:!1,autoFocus:!1,lazyLoad:!0,startAtItem:0,automatic:{enabled:!1,hitArea:!1,pause:4E3,direction:"forward"},controls:{arrows:!0,list:!1,key:!1},callbacks:{ready:function(){},beforeMove:function(){},afterMove:function(){},
afterChange:function(){},userPrevious:function(){},userNext:function(){},cycle:function(){}},classNames:{mask:"rev-mask",container:"rev-container",item:"rev-item",itemClone:"rev-clone",touch:"rev-touch",currentItem:"rev-current",next:"rev-next",previous:"rev-previous",focus:"rev-focus",beforeFocus:"rev-before-focus",afterFocus:"rev-after-focus",enabled:"rev-enabled"},debug:!1},b||{});this.options.infinite&&(this.options.wraparound=!0);this.el=a instanceof jQuery?a:$(a);this.elementIsValid()&&this.init()};
i.prototype={namespace:"rev",init:function(){var a=this.namespace,b=this.options,c=b.callbacks.ready;this.win=$(window);this.controls={};this.vendorPrefixes=["-webkit-","-moz-","-ms-","-o-",""];this.events={mouseDown:"mousedown."+a,mouseMove:"mousemove."+a,mouseEnter:"mouseenter."+a,mouseLeave:"mouseleave."+a,keyDown:"keydown."+a,click:"click."+a,resize:"resize."+a};this.events.transitionEnd="transitionend."+a+" webkitTransitionEnd."+a+" oTransitionEnd."+a+" msTransitionEnd."+a;b.debug?(this.events.touchStart=
"mousedown."+a+" touchstart."+a,this.events.touchMove="mousemove."+a+" touchmove."+a,this.events.touchEnd="mouseup."+a+" touchend."+a):(this.events.touchStart="touchstart."+a,this.events.touchMove="touchmove."+a,this.events.touchEnd="touchend."+a);this.events.touchCancel="touchcancel."+a;this.win.on(this.events.resize,$.proxy(this.onWindowResize,this));this.setupElements();this.setupState();b.infinite&&(this.infinite={});(b.touch||b.debug)&&this.useTouch(!0);c&&this.dispatchEvent("ready",c)},useTouch:function(a){var b=
this.options;this.touch={};a?(this.addTouchEventListeners(),this.el.addClass(b.classNames.touch)):(this.removeTouchEventListeners(),this.el.removeClass(b.classNames.touch))},setupElements:function(){var a=this.options;this.el.addClass(a.classNames.mask);this.mask=this.el;this.container=$("."+a.classNames.container,this.el);if(a.transforms||a.transform3d)this.applyVendorStyle(this.container,"transform-origin","0 0"),this.container.css("left","auto")},cacheItems:function(){this.items=this.container.children();
this.options.infinite&&(this.cloneItems(),this.items=this.container.children())},cloneItems:function(){var a=this.calculateItemsPerPage(),b=this.options.classNames.itemClone,c;if("undefined"!==typeof this.clones){if(a===this.clones.length/2)return;this.clones.hasOwnProperty("remove")&&(this.clones.remove(),this.clones=void 0)}c=this.items.slice(0,a).clone();a=this.items.slice(-a).clone();this.container.append(c).prepend(a);this.clones=$.merge(c,a).addClass(b);this.lazy(this.clones)},setupState:function(){var a=
this.options,b;this.state={};this.state.element=this.el;this.state.busy=!1;this.cacheItems();this.measure();this.state.lastItemIndex=-1;this.state.containerSize<this.state.maskSize?(this.state.currentItemIndex=0,this.disable()):(b=a.startAtItem+this.state.startItemIndex,this.state.currentItemIndex=this.forceValidItemIndex(b),this.enable(),this.state.position=this.calculateCurrentPosition(),0!==this.state.position&&this.syncPosition(0),this.syncPosition(),this.syncControlsWithState());a.lazyLoad&&
this.lazy(this.getVisibleItems())},addControls:function(){var a=this.options,b,c;a.controls.arrows?(b='<button class="'+a.classNames.previous+'" title="Previous"></button>',c='<button class="'+a.classNames.next+'" title="Next"></button>',b=[b,c],this.el.prepend(b.join("")),this.controls={previous:$("."+a.classNames.previous,this.el),next:$("."+a.classNames.next,this.el)}):this.controls={};this.addControlsEventListeners()},removeControls:function(){var a=this.controls;"undefined"!==typeof a.previous&&
a.previous.remove();"undefined"!==typeof a.next&&a.next.remove();this.removeControlsEventListeners()},syncPosition:function(a){var b=this.calculateCurrentPosition(),a="undefined"===typeof a?this.options.speed:a;$.extend(this.state,{position:b});this.move(b,a)},syncControlsWithState:function(){var a=this.state,b=this.options,c=this.controls,e=b.wraparound,d=a.currentItemIndex,f=a.startPageItemIndex,g=a.endPageItemIndex,h=c.previous,c=c.next,i=this.items,j=b.classNames.currentItem,k=$(i[d]);e||(h&&
(d<=f?h.attr("disabled",""):h.removeAttr("disabled")),c&&(d>=g?c.attr("disabled",""):c.removeAttr("disabled")));$(i).filter("."+j).removeClass(j);k.addClass(j);b.autoFocus&&1===a.itemsPerPage&&this.focusItem(k)},focusItem:function(a){var a=a instanceof jQuery?a:$(a),b=this.options.classNames,c=b.focus,e=b.beforeFocus,b=b.afterFocus,d=this.lastFocus;if(!d||a.get(0)!==d.get(0))d&&(d.removeClass(c),d.prev().removeClass(e),d.next().removeClass(b)),a.prev().addClass(e),a.next().addClass(b),a.addClass(c),
this.lastFocus=a},initCycle:function(){var a=this.options,b=this.getHitArea();b&&!0===a.debug&&this.el.append('<div style="background-color:rgba(255,0,0,.25);width:'+b[2]+";height:"+b[3]+";position:absolute; top:"+b[1]+";left:"+b[0]+';" />');this.state.cycling=!1;this.startCycle();this.addCycleEventListeners()},killCycle:function(){this.stopCycle();this.removeCycleEventListeners();clearInterval(this.resetTimeout)},startCycle:function(){var a=this,b=this.options,c=b.automatic.direction,e=b.speed+b.automatic.pause;
this.isCycling()||(this.stopCycle(),this.cycleInterval=setInterval(function(){"backward"===c?a.previous():a.next();a.dispatchEvent("userNext",b.callbacks.cycle)},e),this.state.cycling=!0)},stopCycle:function(){this.isCycling()&&(clearInterval(this.cycleInterval),this.state.cycling=!1)},resetCycle:function(){var a=this,b=this.options,b=b.speed+b.automatic.pause;this.killCycle();this.resetTimeout=setTimeout(function(){a.startCycle()},b)},detectHitAreaHit:function(){var a=this.getHitArea(),b=this.el.offset(),
c=event.pageX-b.left,b=event.pageY-b.top,e=parseInt(a[0],10),d=parseInt(a[1],10),f=e+parseInt(a[2],10),a=d+parseInt(a[3],10);this.isCycling()?c>e&&(b>d&&c<f&&b<a)&&this.stopCycle():(c<e||b<d||c>f||b>a)&&this.startCycle()},addControlsEventListeners:function(){var a=this,b=this.controls,c=this.options,e=c.classNames,d=this.events;if(b.previous)this.el.on(d.mouseDown,"."+e.previous,$.proxy(this.onPreviousClick,this));if(b.next)this.el.on(d.mouseDown,"."+e.next,$.proxy(this.onNextClick,this));if(c.controls.key)this.win.on(d.keyDown,
$.proxy(this.onKeyDown,this));if(c.autoFocus)this.el.on(d.click,"."+e.item,function(){a.focusItem(this)})},removeControlsEventListeners:function(){var a=this.events;this.win.off(a.keyDown);this.el.off(a.transitionEnd).off(a.mouseDown).off(a.click);this.removeTouchEventListeners()},addCycleEventListeners:function(){var a=this.events;if(this.getHitArea())this.win.on(a.mouseMove,$.proxy(this,"onMouseMove"));else this.el.on(a.mouseEnter,$.proxy(this,"onMouseEnter")).on(a.mouseLeave,$.proxy(this,"onMouseLeave"))},
removeCycleEventListeners:function(){var a=this.events;this.getHitArea()?this.win.off(a.mouseMove):this.el.off(a.mouseEnter).off(a.mouseLeave)},addTouchEventListeners:function(){this.el.one(this.events.touchStart,"."+this.options.classNames.container,$.proxy(this.onTouchStart,this))},removeTouchEventListeners:function(){var a=this.events;this.win.off(a.touchMove).off(a.touchEnd).off(a.touchCancel);this.el.off(a.touchStart)},startTouchEventListeners:function(){var a=this.events;this.el.off(a.touchStart);
this.win.on(a.touchMove,$.proxy(this.onTouchMove,this)).one(a.touchEnd,$.proxy(this.onTouchEnd,this)).one(a.touchCancel,$.proxy(this.onTouchEnd,this))},resetTouchEventListeners:function(){this.removeTouchEventListeners();this.addTouchEventListeners()},measure:function(){var a=this.options,b=this.items,c=b.length,e=$(b[0]).outerWidth(),d=100*(1/c),f,g,h;this.isFluid()?(this.container.css("width",100*c+"%"),d!==this.state.itemSizePercent&&(this.container.detach(),$.each(b,function(){$(this).css("width",
d+"%")}),this.el.append(this.container),e=$(b[0]).outerWidth())):this.isFixed()&&this.container.css("width",c*e+"px");c=this.mask.outerWidth();f=this.container.outerWidth();g=this.calculateItemsPerPage();h=this.calculatePages(b,g);a.infinite?(a=g,b=b.length-g-1):(a=0,b=b.length-1);$.extend(this.state,{itemSize:e,itemSizePercent:d,maskSize:c,containerSize:f,itemsPerPage:g,startItemIndex:a,endItemIndex:b,pages:h,startPageItemIndex:h[0],endPageItemIndex:h[h.length-1]})},resize:function(){this.cacheItems();
this.measure();this.state.containerSize<this.state.maskSize?(this.state.currentItemIndex=this.forceValidItemIndex(0),this.disable()):(this.enable(),this.state.position=this.calculateCurrentPosition(),this.syncPosition(0),this.syncControlsWithState())},onPreviousClick:function(a){a.preventDefault();this.previous();this.dispatchEvent("userPrevious",this.options.callbacks.userPrevious)},onNextClick:function(a){a.preventDefault();this.next();this.dispatchEvent("userNext",this.options.callbacks.userNext)},
onMouseEnter:function(){this.stopCycle()},onMouseLeave:function(){this.startCycle()},onMouseMove:function(){this.detectHitAreaHit()},onKeyDown:function(a){switch(a.which){case 37:case 38:this.onPreviousClick(a);break;case 39:case 40:this.onNextClick(a)}},onWindowResize:function(){this.resize()},onTransitionEnd:function(){this.el.off(this.events.transitionEnd,"."+this.options.classNames.container);this.afterMove()},onTouchStart:function(a){2!==a.button&&(a=this.normalizeTouchEvent(a),this.touch={scroll:void 0,
startX:a.pageX,startY:a.pageY,lastX:0,lastY:0,startPos:this.getPosition(),startIndex:this.state.currentItemIndex},this.startTouchEventListeners())},onTouchMove:function(a){var a=this.normalizeTouchEvent(a),b=this.touch,c=b.startX-a.pageX,e=b.startY-a.pageY,d=a.pageX,f=a.pageY,g=this.forceValidPosition(b.startPos-c);$.extend(this.touch,{lastX:d,lastY:f});"undefined"===typeof b.scroll&&(this.touch.scroll=!!(b.scroll||Math.abs(c)<Math.abs(e)),this.touch.scroll||this.lock());this.touch.scroll||(a.preventDefault(),
this.move(g,0))},onTouchEnd:function(a){var b=this.touch,c=b.lastX-b.startX;!1===b.scroll&&(a.preventDefault(),this.state.currentItemIndex=this.calculateItemIndexAtPosition(this.getPosition()),0>c&&(this.state.currentItemIndex+=1),a=this.forceValidItemIndex(this.state.currentItemIndex),this.state.currentItemIndex=-1,this.toItem(a));this.resetTouchEventListeners();this.unlock()},normalizeTouchEvent:function(a){var b=a.originalEvent;b&&b.changedTouches&&(a.pageX=b.changedTouches[0].pageX,a.pageY=b.changedTouches[0].pageY);
return a},applyVendorStyle:function(a,b,c,e){var d=this.vendorPrefixes,f={},g;for(g=0;g<d.length;g++)f[d[g]+b]=!0===e?d[g]+c:c;a.css(f)},parseVendorStyle:function(a,b){var c=this.vendorPrefixes,e,d;for(d=0;d<c.length;d++)if((e=a.css(c[d]+b))&&"none"!==e)return e;return!1},forceValidItemIndex:function(a){var b=this.state,c=b.startItemIndex,b=b.endItemIndex;return a<c?c:a>b?b:a},forceValidPageIndex:function(a){var b=this.state.pages.length-1;return 0>a?0:a>b?b:a},forceValidPosition:function(a){var b=
this.calculateMinPosition(),c=this.calculateMaxPosition();return a<c?c:a>b?b:a},calculateItemsPerPage:function(){var a=this.state,b;"undefined"!==typeof a&&"undefined"!==typeof a.maskSize?(b=a.maskSize,a=a.itemSize):(b=this.mask.outerWidth(),a=$(this.items[0]).outerWidth());b=Math.floor(b/a);return 0===b?1:b},calculateItemIndexAtPosition:function(a){a=Math.floor(Math.abs(a/this.state.itemSize));return this.forceValidItemIndex(a)},calculateFirstVisibleItemIndexAtPosition:function(a){return this.calculateItemIndexAtPosition(a-
1)},calculateLastVisibleItemIndexAtPosition:function(a){return this.calculateItemIndexAtPosition(a-this.state.maskSize+1)},calculateCurrentPosition:function(){var a=this.calculatePositionAtItemIndex(this.state.currentItemIndex);return this.forceValidPosition(a)},calculatePositionAtItemIndex:function(a){var b=this.state,a=this.forceValidItemIndex(a);return Math.floor(-1*a*b.itemSize)},calculateMinPosition:function(){return this.calculatePositionAtItemIndex(this.state.startItemIndex)},calculateMaxPosition:function(){var a=
this.state;return this.calculatePositionAtItemIndex(a.endItemIndex)-(a.itemSize-a.maskSize)},calculatePages:function(a,b){for(var c=a.not("."+this.options.classNames.itemClone).length,e=Math.ceil(c/b),d=[],f=0,g=0;f<e;)g<c&&(d[f]=g,g+=b,f++);this.options.infinite||0<e%b&&(d[f-1]=c-b);return d},getPosition:function(){var a=this.container,b;return this.options.transforms&&(b=this.parseVendorStyle(a,"transform"))?(a=b.substr(7,b.length-8).split(", "))&&a[4]?a[4]:0:a.position().left},filterInfinitePosition:function(a){var b=
this.calculateMinPosition(),c=this.calculateMaxPosition(),e=this.calculatePositionAtItemIndex(this.state.lastItemIndex),d=this.state.itemSize*this.clones.length/2;return a===b&&e===c?a+d:a===c&&e===b?a-d:a},convertPositionToPercentage:function(a){return!1===this.options.transforms?100*(a/this.state.maskSize):100*(a/this.state.containerSize)},move:function(a,b,c){var e=this,d=this.container,f=this.options,g=f.classNames,b="undefined"===typeof b?0:b,c="undefined"===typeof c?f.easing:c,h=this.getPosition();
if(a!==h)if(f.infinite&&!this.infiniteFlag&&(h=this.filterInfinitePosition(a),h!==a&&(this.infiniteFlag=!0,this.infinite.nextPosition=a,this.infinite.nextTime=b,this.infinite.nextEasing=c,setTimeout(function(){e.move(e.infinite.nextPosition,e.infinite.nextTime,e.infinite.nextEasing);e.infiniteFlag=!1},1),a=h,b=0)),a=this.isFluid()?this.convertPositionToPercentage(a)+"%":a+"px",this.beforeMove(),f.transitions){this.applyVendorStyle(d,"transition-duration",b+"ms");this.applyVendorStyle(d,"transition-timing-function",
c);if(0===b)this.onTransitionEnd();else this.el.off(this.events.transitionEnd,"."+g.container),this.el.on(this.events.transitionEnd,"."+g.container,$.proxy(this.onTransitionEnd,this));f.transforms||f.transform3d?this.applyVendorStyle(d,"transition-property",0<b?"transform":"none",!0):this.applyVendorStyle(d,"transition-property",0<b?"left":"none");f.transform3d?this.applyVendorStyle(d,"transform","translate3d("+a+", 0, 0)"):f.transforms?this.applyVendorStyle(d,"transform","translate("+a+", 0)"):d.stop().css({left:a})}else d.stop().animate({left:a},
b,c,$.proxy(this.afterMove,this))},beforeMove:function(){var a=this.options,b=a.callbacks.beforeMove;a.lazyLoad&&this.lazy(this.getVisibleItems());this.syncControlsWithState();this.lock();this.dispatchEvent("beforemove",b)},afterMove:function(){var a=this.options,b=a.callbacks.afterMove;a.lazyLoad&&this.lazy(this.getVisibleItemsAtPosition(this.getPosition()));this.syncControlsWithState();this.unlock();this.dispatchEvent("aftermove",b);this.state.indexChanged&&(this.state.indexChanged=!1,this.dispatchEvent("afterchange",
a.callbacks.afterChange))},dispatchEvent:function(a,b){var c=this.getState(),e=a.toLowerCase();$(this).trigger(e,c);$.isFunction(b)&&b.call(this,c)},lazy:function(a){var b;$(a).each(function(){b=$(this).find("img[data-src]").not("img[src]");0<b.length&&b.each(function(){$(this).bind("load",function(){$(this).removeAttr("data-src")}).attr("src",$(this).data("src"))})})},lock:function(){this.state.busy=!0},unlock:function(){this.state.busy=!1},getState:function(){return $.extend({},this.state)},getControls:function(){return this.controls},
getHitArea:function(){var a=this.options.automatic.hitArea;return a&&4===a.length?a:!1},getItems:function(){return this.items},getItemAt:function(a){return this.items[this.forceValidItemIndex(a)]},getVisibleItemsAtPosition:function(a){var b=this.calculateFirstVisibleItemIndexAtPosition(a),a=this.calculateLastVisibleItemIndexAtPosition(a);return this.items.slice(b,a+1)},getVisibleItemsAtIndex:function(a){a=this.calculatePositionAtItemIndex(a);return this.getVisibleItemsAtPosition(a)},getVisibleItems:function(){return this.getVisibleItemsAtIndex(this.state.currentItemIndex)},
setCurrentItemIndex:function(a){var b=this.state.currentItemIndex,a=this.forceValidItemIndex(a);return a!==b?(this.state.lastItemIndex=b,this.state.currentItemIndex=a,this.state.indexChanged=!0):!1},getCurrentItemIndex:function(){var a=this.state;return a?a.currentItemIndex:0},getNextItemIndex:function(){return this.getItemIndex(1)},getPreviousItemIndex:function(){return this.getItemIndex(-1)},getItemIndex:function(a){var b=this.state,c=b.currentItemIndex,e=b.startItemIndex,b=b.endItemIndex,d=0<a,
f=d?b:e;return c===f?this.options.wraparound?d?e:b:f:c+a},toItem:function(a,b){var c=this.items,c=$.isNumeric(a)?a:$.inArray(a,c);this.setCurrentItemIndex(c)&&this.syncPosition(b)},toPage:function(a,b){var c=this.state,e=c.pages,c=c.currentItemIndex,a=this.forceValidPageIndex(a),e=e[a];e!==c&&this.toItem(e,b)},getNextPageIndex:function(){return this.getPageIndex(1)},getPreviousPageIndex:function(){return this.getPageIndex(-1)},getPageIndex:function(a){var b=this.state,c=b.pages,e=c.length,d=b.currentItemIndex,
b=Math.ceil(d/b.itemsPerPage),f=0<a,g=f?e-1:0;return d===c[g]?this.options.wraparound?f?0:e-1:g:b+1*a},elementIsValid:function(){var a=this.el,b=this.options,c=$("."+b.classNames.container,a),b=$("."+b.classNames.item,c);"undefined"===typeof this.validElement&&(this.validElement=a&&a.length&&c&&c.length&&b&&1<b.length);return this.validElement},isFluid:function(){return"fluid"===this.options.mode},isFixed:function(){return"fixed"===this.options.mode},isLocked:function(){return this.state.busy},isEnabled:function(){return this.state.enabled},
isCycling:function(){return this.state.cycling},next:function(){this.isFluid()?this.toNextItem():this.toNextPage()},previous:function(){this.isFluid()?this.toPreviousItem():this.toPreviousPage()},toNextItem:function(){this.toItem(this.getNextItemIndex())},toPreviousItem:function(){this.toItem(this.getPreviousItemIndex())},toNextPage:function(){this.toPage(this.getNextPageIndex())},toPreviousPage:function(){this.toPage(this.getPreviousPageIndex())},addItems:function(a,b){b?this.container.prepend(a):
this.container.append(a);this.cacheItems();this.resize()},enable:function(){if(!this.isEnabled()){var a=this.options;this.elementIsValid()?(this.addControls(),a.automatic.enabled&&this.initCycle(),this.el.addClass(a.classNames.enabled),this.state.enabled=!0):this.state.enabled=!1}},disable:function(){this.isEnabled()&&(this.elementIsValid()?(this.removeControls(),this.container.stop(),this.isCycling()&&this.killCycle(),this.state.enabled=!1,this.el.removeClass(this.options.classNames.enabled)):this.state.enabled=
!1)},destroy:function(){this.elementIsValid()&&(this.disable(),this.container.removeAttr("style"),$.each(this.items,function(){$(this).removeAttr("style")}),this.clones.remove(),this.el.removeClass((void 0).classNames.mask),this.win.off(this.events.resize,$.proxy(this.onWindowResize,this)))}};this.Revolver=i}).call(this);